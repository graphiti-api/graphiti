<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Graphiti</title>
  <meta name="description" content="Stylish Graph APIs">

  <link rel="stylesheet" href="https://graphiti-api.github.io/graphiti/assets/main.css?ref=wh4t3v45">
  <link rel="alternate" type="application/rss+xml" title="Graphiti" href="/feed.xml">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-127904727-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-127904727-1');
  </script>

  <!-- javascript -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  
</head>


  <body>
    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <header class="navbar navbar-inverse normal" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="https://graphiti-api.github.io/graphiti" class="navbar-brand">Graphiti</a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a class="nav-link" href="https://graphiti-api.github.io/graphiti/quickstart">Quickstart</a>
        </li>
        <li>
          <a class="nav-link" href="https://graphiti-api.github.io/graphiti/guides">Guides</a>
        </li>
        <li>
          <a class="nav-link" href="https://graphiti-api.github.io/graphiti/tutorial">Tutorial</a>
        </li>
        <li>
          <a class="nav-link" href="https://graphiti-api.github.io/graphiti/js">Spraypaint</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li>
          <a href="https://github.com/graphiti-api/graphiti" class="button">Fork on Github</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

        <div class="container">
          <div class="toc col-md-3">
  <h1 id="debugging">Debugging</h1>

  <ul>
    <li>1 <a href="#debugger">Debugger</a>
      <ul>
        <li><a href="#json-output">JSON Output</a></li>
        <li><a href="#configuration">Configuration</a></li>
      </ul>
    </li>
    <li>2 <a href="#rake-tasks">Rake Tasks</a>
      <ul>
        <li><a href="#graphitirequest">graphiti:request</a></li>
        <li><a href="#graphitibenchmark">graphiti:benchmark</a></li>
      </ul>
    </li>
    <li>3 <a href="#tips">Tips</a></li>
  </ul>

</div>

<div class="col-md-8">
  <h2 id="debugger">1 Debugger</h2>

  <p>Graphiti comes with a debugger that shows the queries executed for a
given request. Remember that Resources <a href="https://graphiti-api.github.io/graphiti/guides/concepts/resources#query-interface">have a query interface</a> independent of a request or response. And Resources connect similar to ActiveRecord’s <code class="highlighter-rouge">includes</code>:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">employees</span> <span class="o">=</span> <span class="no">EmployeeResource</span><span class="p">.</span><span class="nf">all</span>
<span class="no">PositionResource</span><span class="p">.</span><span class="nf">all</span><span class="p">(</span><span class="ss">filter: </span><span class="p">{</span> <span class="ss">employee_id: </span><span class="n">employees</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:id</span><span class="p">)</span> <span class="p">})</span></code></pre></figure>

  <blockquote>
    <p><em>Remember, this is all <a href="https://graphiti-api.github.io/graphiti/guides/concepts/resources#customizing-relationships">customizable</a></em>.</p>
  </blockquote>

  <p>That means we can log the requests made by individual Resources:</p>

  <p><code class="highlighter-rouge">/api/v1/employees?include=notes,positions.department.teams</code></p>
  <p align="center">
  <img width="100%" src="https://user-images.githubusercontent.com/55264/46084994-f5425e00-c172-11e8-8c40-aa7074e6dc6d.png" />
</p>

  <p>And even copy/paste these queries into a console session to debug:</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bin/rails c
<span class="gp">&gt;&gt; </span>TeamResource.all<span class="o">({</span>:filter<span class="o">=</span>&gt;<span class="o">{</span>:department_id<span class="o">=</span>&gt;<span class="s2">"1,2,3"</span><span class="o">}})</span></code></pre></figure>

  <p>If you’re having trouble with a request, see if you can isolate to a
specific Resource, then test that Resource directly.</p>

  <p>Finally: if an error occurs, we’ll note the query that caused it:</p>

  <p align="center">
  <img width="100%" src="https://user-images.githubusercontent.com/55264/46086595-6c2d2600-c176-11e8-9b57-1b27d380e9fe.png" />
</p>

  <h3 id="json-output">1.1 JSON Output</h3>

  <p>It can be helpful to have this debug output come back as part of the
JSON response. To enable this:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/application_controller.rb</span>
<span class="k">def</span> <span class="nf">allow_graphiti_debug_json?</span>
  <span class="kp">true</span>
  <span class="c1"># or, current_user.admin?</span>
  <span class="c1"># or, Rails.env.development?</span>
<span class="k">end</span></code></pre></figure>

  <p>And request the debug output:</p>

  <p><code class="highlighter-rouge">/your/url?debug=true</code></p>

  <p>You should now see the debug output in <code class="highlighter-rouge">meta</code>:</p>

  <p align="center">
  <img width="100%" src="https://user-images.githubusercontent.com/55264/46085006-fe332f80-c172-11e8-946e-bf1386362a90.png" />
</p>

  <p><br /></p>

  <p>If there’s an error, and you’ve <a href="https://graphiti-api.github.io/graphiti/guides/concepts/error-handling#displaying-raw-errors">enabled raw errors</a>, you’ll also see the query that caused the error in the JSON response:</p>

  <p><br /></p>

  <p align="center">
  <img width="100%" src="https://user-images.githubusercontent.com/55264/46086370-ef01b100-c175-11e8-81b9-917d95e195c7.png" />
</p>

  <p><br /></p>

  <h3 id="configuration">1.2 Configuration</h3>

  <p>By default, we’ll log to <code class="highlighter-rouge">Rails.logger</code>, and only enable debugging (logs
or JSON) when <code class="highlighter-rouge">Rails.logger.level</code> is set to <code class="highlighter-rouge">debug</code>. Here are the
various ways to configure.</p>

  <p>Use <code class="highlighter-rouge">config.debug</code> to explicitly toggle debugging:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/graphiti.rb</span>
<span class="no">Graphiti</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">debug</span> <span class="o">=</span> <span class="kp">false</span>
<span class="k">end</span>

<span class="c1"># Or use environment variable</span>
<span class="c1"># GRAPHITI_DEBUG=false</span></code></pre></figure>

  <p>Use <code class="highlighter-rouge">config.debug_models</code> to get additional (but verbose) output:</p>

  <p align="center">
  <img width="100%" src="https://user-images.githubusercontent.com/55264/46088701-ef507b00-c17a-11e8-8d26-af17b19b8ce9.png" />
</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/graphiti.rb</span>
<span class="no">Graphiti</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">debug_models</span> <span class="o">=</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># Or use environment variable</span>
<span class="c1"># GRAPHITI_DEBUG_MODELS=true</span></code></pre></figure>

  <p>As noted above, <code class="highlighter-rouge">allow_graphiti_debug_json?</code> must return <code class="highlighter-rouge">true</code> if you
want JSON output:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/application_controller.rb</span>
<span class="k">def</span> <span class="nf">allow_graphiti_debug_json?</span>
  <span class="kp">true</span>
  <span class="c1"># or, current_user.admin?</span>
  <span class="c1"># or, Rails.env.development?</span>
<span class="k">end</span></code></pre></figure>

  <p>Note you need to explicitly pass <code class="highlighter-rouge">?debug=true</code> in the request.</p>

  <p>Assign a different logger:</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Graphiti</span><span class="p">.</span><span class="nf">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="p">.</span><span class="nf">new</span><span class="p">(.</span><span class="nf">.</span><span class="o">.</span><span class="p">)</span>

<span class="c1"># Or the built-in STDOUT logger:</span>
<span class="no">Graphiti</span><span class="p">.</span><span class="nf">logger</span> <span class="o">=</span> <span class="no">Graphiti</span><span class="p">.</span><span class="nf">stdout_logger</span></code></pre></figure>

  <p>Manually apply the debugging (when using Rails, this normally happens in
a <code class="highlighter-rouge">around_action</code>):</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Graphiti</span><span class="o">::</span><span class="no">Debugger</span><span class="p">.</span><span class="nf">debug</span> <span class="k">do</span>
  <span class="no">EmployeeResource</span><span class="p">.</span><span class="nf">all</span>
<span class="k">end</span></code></pre></figure>

  <h3 id="rake-tasks">2 Rake Tasks</h3>

  <p>There are some common debugging scenarios that are possible to do
manually, but their frequency warrants common patterns. For these, we
have rake tasks.</p>

  <h4 id="graphitirequest">2.1 graphiti:request</h4>

  <blockquote>
    <p><code class="highlighter-rouge">bin/rake graphiti:request[PATH,DEBUG]</code></p>
  </blockquote>

  <p>Execute a request using <code class="highlighter-rouge">ActionDispatch::Integration::Session</code> (which
underlies request specs).</p>

  <p>This can be helpful when you don’t have, or don’t want to spin up, a web
server. Imagine you want to debug something on production, so you shell
into a docker container and edit some files locally. Now you want to
execute a request and see if your changes worked:</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bin/rake graphiti:request[/employees]</code></pre></figure>

  <p>Will execute the request and spit out the JSON response. You may want to
run with the Debugger enabled:</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bin/rake graphiti:request[/employees,true]</code></pre></figure>

  <p>Which add Debugger output as well.</p>

  <p>The <code class="highlighter-rouge">PATH</code> should not contain the domain unless you want to hit a live
API instead of a test server.</p>

  <h4 id="graphitibenchmark">2.2 graphiti:benchmark</h4>

  <blockquote>
    <p><code class="highlighter-rouge">bin/rake graphiti:benchmark[PATH,NUM_REQUESTS]</code></p>
  </blockquote>

  <p>It can be helpful to run a quick benchmark without hitting a live web
server, to eliminate the vagaries of latency. To do this:</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bin/rake graphiti:benchmark[/employees,100]</code></pre></figure>

  <p>Which will return the average response time.</p>

  <h2 id="tips">3 Tips</h2>

  <p>When debugging an application, try to isolate the individual Resource
call and debug the Resource directly (instead of running the entire
request). This helps eliminate variables, and plain ruby code is easier
to work with. If possible, try to remove Graphiti entirely and focus on
your Models and Backends.</p>

  <p>The most common scenario is debugging a query. We suggest overriding
<code class="highlighter-rouge">resolve</code> and using <a href="https://github.com/pry/pry">pry</a> (or equivalent):</p>

  <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Introspect the scope without firing a query</span>
<span class="c1"># Call 'super' to fire the query</span>
<span class="k">def</span> <span class="nf">resolve</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
  <span class="nb">binding</span><span class="p">.</span><span class="nf">pry</span>
<span class="k">end</span></code></pre></figure>

  <p><br />
<br /></p>

</div>

        </div>
      </div>
    </main>
    <div class="main-footer main-footer--dark">
  <div class="container">
    <div class="row">
      <div class="col-sm-4 menu">
        <h3>Overview</h3>
        <ul>
          <li>
            <a href="https://graphiti-api.github.io/graphiti/quickstart">Quickstart</a>
          </li>
          <li>
            <a href="https://graphiti-api.github.io/graphiti/tutorial">Tutorial</a>
          </li>
          <li>
            <a href="https://graphiti-api.github.io/graphiti/guides">Guides</a>
          </li>
        </ul>
      </div>
      <div class="col-sm-4 menu">
        <h3>Contact</h3>
        <ul>
          <li>
            <a target="_blank" href="https://join.slack.com/t/jsonapi-suite/shared_invite/enQtMjkyMTA3MDgxNTQzLWVkMDM3NTlmNTIwODY2YWFkMGNiNzUzZGMzOTY3YmNmZjBhYzIyZWZlZTk4YmI1YTI0Y2M0OTZmZGYwN2QxZjg">Slack Chat</a>
          </li>
          <li>
            <a href="mailto:richmolj@gmail.com">Email</a>
          </li>
        </ul>
      </div>
      <div class="col-sm-4 menu">
        <h3>Related</h3>
        <ul>
          <li>
            <a target="_blank" href="http://jsonapi.org">JSONAPI Spec</a>
          </li>
          <li>
            <a target="_blank" href="http://jsonapi-rb.org">jsonapi-rb</a>
          </li>
          <li>
            <a target="_blank" href="https://vuejs.org/">VueJS</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <script type="text/javascript">
$(function () {

  var flipTabs = function() {
    var isTS = true;
    if (localStorage.getItem('js-lang') === 'javascript') {
      isTS = false;
    }

    $('.code-tabs').each(function(index, el) {
      if (isTS) {
        console.log('hiding js');
        $($(el).children()[1]).hide();
        $($(el).children()[0]).show();
      } else {
        console.log('hiding ts');
        $($(el).children()[0]).hide();
        $($(el).children()[1]).show();
      }
    });

    if (isTS) {
      $('.tab.typescript').addClass('active');
      $('.tab.javascript').removeClass('active');
    } else {
      $('.tab.typescript').removeClass('active');
      $('.tab.javascript').addClass('active');
    }
  }

  $('.tab').click(function() {
    if ($(this).hasClass('typescript')) {
      localStorage.setItem('js-lang', 'typescript');
    } else {
      localStorage.setItem('js-lang', 'javascript');
    }

    flipTabs();
  });

  flipTabs();
})
</script>

  </body>
</html>
