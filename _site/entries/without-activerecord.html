<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
<title>JSONAPI Suite</title>
<meta name="viewport" content="width=device-width">
<meta name="author" content="">
<link rel="stylesheet" href="/jsonapi_suite/css/main.css">
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:500,600' rel='stylesheet' type='text/css'>

    </head>

    <body>
        <div class="container">
            <div class="overview" style='background-image: url("/jsonapi_suite/img/vertical_cloth.png") !important'>
                <span class="toggle">close</span>
                <header>
  <span>JSONAPI Suite</span>
</header>

                <ul id="nav">
    
    
    <li  class="parent current">
        <a href="#intro">Introduction</a>
        
            <ul>
                
                
                    <li >
                        <a href="#features">Features</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li >
        <a href="#installation">Installation</a>
        
    </li>
    
    <li  class="parent">
        <a href="#reads">Reads</a>
        
            <ul>
                
                
                    <li >
                        <a href="#basics">The Basics</a>
                        
                    </li>
                
                    <li >
                        <a href="#filtering">Filtering</a>
                        
                    </li>
                
                    <li >
                        <a href="#includes">Includes</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#writes">Writes</a>
        
            <ul>
                
                
                    <li >
                        <a href="#deserialization">Deserialization</a>
                        
                    </li>
                
                    <li >
                        <a href="#validations">Validations</a>
                        
                    </li>
                
                    <li >
                        <a href="#strong_resources">Strong Resources</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li >
        <a href="#error-handling">Error Handling</a>
        
    </li>
    
    <li >
        <a href="#spec-helpers">Spec Helpers</a>
        
    </li>
    
    <li >
        <a href="#swagger">Swagger</a>
        
    </li>
    
    <li  class="parent">
        <a href="#jsonapi-plus">JSON API Plus</a>
        
            <ul>
                
                
                    <li >
                        <a href="#nested-relationships">Nested Relationships</a>
                        
                    </li>
                
                    <li >
                        <a href="#extra-fields">Extra Fields</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li >
        <a href="#without-activerecord">Usage Without ActiveRecord</a>
        
    </li>
    
</ul>
            </div>

            <div class="content">
                <span class="toggle">open</span>
                <p>So far our examples have assumed you are using <code class="highlighter-rouge">ActiveRecord</code>, and we do
treat that as the default. But everything can be customized. The
following shows how to use the <code class="highlighter-rouge">jsonapi {  }</code> DSL to build up a hash
that can be passed to an alternate ORM:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">jsonapi</span> <span class="k">do</span>
  <span class="n">allow_filter</span> <span class="ss">:name</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
    <span class="n">scope</span><span class="p">[</span><span class="ss">:conditions</span><span class="p">]</span> <span class="o">||=</span> <span class="p">{}</span>
    <span class="n">scope</span><span class="p">[</span><span class="ss">:conditions</span><span class="p">].</span><span class="nf">merge!</span><span class="p">(</span><span class="ss">name: </span><span class="n">value</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">sort</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">dir</span><span class="o">|</span>
    <span class="n">scope</span><span class="p">.</span><span class="nf">merge!</span><span class="p">(</span><span class="ss">order: </span><span class="p">{</span> <span class="n">att</span> <span class="o">=&gt;</span> <span class="n">dir</span> <span class="p">})</span>
  <span class="k">end</span>

  <span class="n">paginate</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">current_page</span><span class="p">,</span> <span class="n">per_page</span><span class="o">|</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_page</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">*</span> <span class="n">per_page</span>
    <span class="n">scope</span><span class="p">.</span><span class="nf">merge!</span><span class="p">(</span><span class="ss">limit: </span><span class="n">per_page</span><span class="p">,</span> <span class="ss">offset: </span><span class="n">offset</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">includes</span> <span class="ss">whitelist: :department</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">includes</span><span class="o">|</span>
    <span class="n">scope</span><span class="p">.</span><span class="nf">merge!</span><span class="p">(</span><span class="ss">include: </span><span class="n">includes</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">index</span>
  <span class="nb">hash</span> <span class="o">=</span> <span class="n">jsonapi_scope</span><span class="p">({})</span>
  <span class="nb">puts</span> <span class="nb">hash</span>
  <span class="c1"># {</span>
  <span class="c1">#   order: { id: :asc },</span>
  <span class="c1">#   limit: 20,</span>
  <span class="c1">#   offset: 0,</span>
  <span class="c1">#   conditions: { name: 'foo' },</span>
  <span class="c1">#   include: :department</span>
  <span class="c1"># }</span>
<span class="k">end</span>
</code></pre>
</div>

<p>And hereâ€™s an example using the elasticsearch gem <a href="https://github.com/richmolj/trample">trample</a>:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EmployeesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">jsonapi</span> <span class="k">do</span>
    <span class="n">allow_filter</span> <span class="ss">:name</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
      <span class="n">scope</span><span class="p">.</span><span class="nf">condition</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">eq</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">allow_filter</span> <span class="ss">:name_prefix</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
      <span class="n">scope</span><span class="p">.</span><span class="nf">condition</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">starts_with</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">paginate</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">current_page</span><span class="p">,</span> <span class="n">per_page</span><span class="o">|</span>
      <span class="n">scope</span><span class="p">.</span><span class="nf">metadata</span><span class="p">.</span><span class="nf">pagination</span><span class="p">.</span><span class="nf">current_page</span> <span class="o">=</span> <span class="n">current_page</span>
      <span class="n">scope</span><span class="p">.</span><span class="nf">metadata</span><span class="p">.</span><span class="nf">pagination</span><span class="p">.</span><span class="nf">per_page</span> <span class="o">=</span> <span class="n">per_page</span>
      <span class="n">scope</span>
    <span class="k">end</span>

    <span class="n">sort</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">dir</span><span class="o">|</span>
      <span class="n">scope</span><span class="p">.</span><span class="nf">metadata</span><span class="p">.</span><span class="nf">sort</span> <span class="o">=</span> <span class="p">[{</span><span class="ss">att: </span><span class="n">att</span><span class="p">,</span> <span class="ss">dir: </span><span class="n">dir</span><span class="p">}]</span>
      <span class="n">scope</span>
    <span class="k">end</span>

    <span class="n">includes</span> <span class="ss">whitelist: </span><span class="p">{</span> <span class="ss">index: :pets</span> <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">includes</span><span class="o">|</span>
      <span class="n">scope</span><span class="p">.</span><span class="nf">metadata</span><span class="p">.</span><span class="nf">records</span><span class="p">[</span><span class="ss">:includes</span><span class="p">]</span> <span class="o">=</span> <span class="n">includes</span>
      <span class="n">scope</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">jsonapi_scope</span><span class="p">(</span><span class="no">Search</span><span class="o">::</span><span class="no">Employee</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
    <span class="n">search</span><span class="p">.</span><span class="nf">query!</span>

    <span class="n">render_ams</span><span class="p">(</span><span class="n">search</span><span class="p">.</span><span class="nf">records</span><span class="p">.</span><span class="nf">to_a</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

            </div>
        </div>

        <script src="/jsonapi_suite/js/jquery-2.1.1.min.js"></script>
        <script scr="/jsonapi_suite/js/jquery.scrollTo.js"></script>
        <script src="/jsonapi_suite/js/jquery.nav.js"></script>
        <script src="/jsonapi_suite/js/scripts.js"></script>
    </body>
</html>
