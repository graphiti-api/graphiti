<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
<title>JSONAPI Suite</title>
<meta name="viewport" content="width=device-width">
<meta name="author" content="">
<link rel="stylesheet" href="/pages/InfrastructureExperience/jsonapi_suite/css/main.css">
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:500,600' rel='stylesheet' type='text/css'>

    </head>

    <body>
        <div class="container">
            <div class="overview" style='background-image: url("/pages/InfrastructureExperience/jsonapi_suite/img/vertical_cloth.png") !important'>
                <span class="toggle">close</span>
                <header>
  <span>JSONAPI Suite</span>
</header>

                <ul id="nav">
    
    
    <li  class="parent current">
        <a href="#intro">Introduction</a>
        
            <ul>
                
                
                    <li >
                        <a href="#features">Features</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li >
        <a href="#installation">Installation</a>
        
    </li>
    
    <li  class="parent">
        <a href="#reads">Reads</a>
        
            <ul>
                
                
                    <li >
                        <a href="#basics">The Basics</a>
                        
                    </li>
                
                    <li >
                        <a href="#filtering">Filtering</a>
                        
                    </li>
                
                    <li >
                        <a href="#includes">Includes</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#writes">Writes</a>
        
            <ul>
                
                
                    <li >
                        <a href="#deserialization">Deserialization</a>
                        
                    </li>
                
                    <li >
                        <a href="#validations">Validations</a>
                        
                    </li>
                
                    <li >
                        <a href="#strong_resources">Strong Resources</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li >
        <a href="#error-handling">Error Handling</a>
        
    </li>
    
    <li >
        <a href="#spec-helpers">Spec Helpers</a>
        
    </li>
    
    <li >
        <a href="#swagger">Swagger</a>
        
    </li>
    
    <li  class="parent">
        <a href="#jsonapi-plus">JSON API Plus</a>
        
            <ul>
                
                
                    <li >
                        <a href="#nested-relationships">Nested Relationships</a>
                        
                    </li>
                
                    <li >
                        <a href="#extra-fields">Extra Fields</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li >
        <a href="#without-activerecord">Usage Without ActiveRecord</a>
        
    </li>
    
</ul>
            </div>

            <div class="content">
                <span class="toggle">open</span>
                <p>At this point we <strong>could</strong> use regular ol’ <a href="https://github.com/rails/strong_parameters">strong_parameters</a>. That would work. However, two things eventually crop up making this a pain point:</p>

<ul>
  <li>You end up typing essentially the same stuff when writing your
<a href="http://swagger.io">swagger</a> documentation, which violates the DRY
principle and leads to code and documentation getting out of sync.</li>
  <li>If your API endpoints accept nested resources, you end up typing the
same nested resource attributes across multiple controllers,
inevitably adding an attribute it one place but forgetting it in others.</li>
</ul>

<p>Enter Strong Resources - DRY strong parameters! Instead of code like
this:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">employee_params</span>
  <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:employee</span><span class="p">).</span><span class="nf">permit</span> <span class="p">\</span>
    <span class="ss">:name</span><span class="p">,</span>
    <span class="ss">:email</span><span class="p">,</span>
    <span class="ss">department_attributes: </span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Write this:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># config/initializers/strong_resources.rb</span>
<span class="no">StrongResources</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span>
  <span class="n">strong_resource</span> <span class="ss">:employee</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:string</span>
    <span class="n">attribute</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="k">end</span>

  <span class="n">strong_resource</span> <span class="ss">:department</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># app/controllers/employees_controller.rb</span>
<span class="k">class</span> <span class="nc">EmployeesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">jsonapi</span> <span class="p">{</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span><span class="nf">code</span><span class="p">.</span><span class="nf">.</span><span class="o">.</span> <span class="p">}</span>

  <span class="n">strong_resource</span> <span class="ss">:employee</span> <span class="k">do</span>
    <span class="n">belongs_to</span> <span class="ss">:department</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># app/controllers/departments_controller.rb</span>
<span class="k">class</span> <span class="nc">DepartmentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">strong_resource</span> <span class="ss">:department</span>
<span class="k">end</span>
</code></pre>
</div>

<p>We’re defining our resource payloads only once, all in
<code class="highlighter-rouge">config/initializers/strong_resources</code>, then referencing those payloads
in each controller. We’ll be able to reference this same metadata when
auto-documenting our API in swagger.</p>

<p>Since this gem uses <a href="https://github.com/zendesk/stronger_parameters">stronger_parameters</a> underneath the hood, we also get free type checking and type casting. For instance passing a <code class="highlighter-rouge">Time</code> for the <code class="highlighter-rouge">name</code> attribute would raise <code class="highlighter-rouge">StrongerParameters::InvalidParameter</code>.</p>

<p>You can also register custom types:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Parameters</span> <span class="o">=</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span>
<span class="n">strong_param</span> <span class="ss">:department_enum</span><span class="p">,</span>
  <span class="ss">swagger: :string</span><span class="p">,</span> <span class="c1"># the corresponding swagger type</span>
  <span class="ss">type: </span><span class="no">Parameters</span><span class="p">.</span><span class="nf">enum</span><span class="p">(</span><span class="s1">'Safety'</span><span class="p">,</span> <span class="s1">'Sales'</span><span class="p">,</span> <span class="s1">'Accounting'</span><span class="p">)</span>

<span class="n">strong_resource</span> <span class="ss">:department</span> <span class="k">do</span>
  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:dep</span><span class="p">]</span><span class="n">rtment_enum</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Would throw a <code class="highlighter-rouge">StrongerParameters::InvalidParameter</code> when passing a
department name that is not ‘Safety’, ‘Sales’, or ‘Accounting’.</p>

<p>Attributes can be conditional as well:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">strong_resource</span> <span class="ss">:employee</span> <span class="k">do</span>
  <span class="n">attribute</span> <span class="ss">:salary</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">,</span> <span class="ss">if: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">controller</span><span class="p">.</span><span class="nf">current_user</span><span class="p">.</span><span class="nf">admin?</span>
  <span class="p">}</span>
<span class="k">end</span>
</code></pre>
</div>

<div class="note info">
  <h6 id="further-reading">Further Reading</h6>
  <div class="note-content">
    <p>To learn more about strong resources, check out the <code class="highlighter-rouge">strong_resources</code>
  libary as well as <a href="https://github.com/zendesk/stronger_parameters">stronger_parameters</a>, the library it uses under the covers.</p>
  </div>
</div>
<div style="height: 7rem"></div>

            </div>
        </div>

        <script src="/pages/InfrastructureExperience/jsonapi_suite/js/jquery-2.1.1.min.js"></script>
        <script scr="/pages/InfrastructureExperience/jsonapi_suite/js/jquery.scrollTo.js"></script>
        <script src="/pages/InfrastructureExperience/jsonapi_suite/js/jquery.nav.js"></script>
        <script src="/pages/InfrastructureExperience/jsonapi_suite/js/scripts.js"></script>
    </body>
</html>
