<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>JSONAPI Suite</title>
  <meta name="description" content="Collection of Ruby libraries for powering JSONAPI-compliant APIs.">

  <link rel="stylesheet" type="text/css" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
  <link rel="stylesheet" href="http://localhost:4000/assets/main.css">
  <link rel="canonical" href="/concepts.html">
  <link rel="alternate" type="application/rss+xml" title="JSONAPI Suite" href="/feed.xml">

  <!-- javascript -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>

  
</head>


  <body>
    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <header class="navbar navbar-inverse normal" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="index.html" class="navbar-brand">JSONAPI Suite</a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a class="nav-link" href="http://localhost:4000/quickstart">Quickstart</a>
        </li>
        <li>
          <a class="nav-link" href="http://localhost:4000/tutorial">Tutorial</a>
        </li>
        <li>
          <a class="nav-link" href="http://localhost:4000/concepts">Concepts</a>
        </li>
        <li class="dropdown">
          <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">
            How-Tos
            <b class="caret"></b>
          </a>

          <ul class="dropdown-menu">
            
              <li>
                <a href="http://localhost:4000/how-to-scope-to-current-user">Scope to Current User</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-cause-side-effects">Cause Side-Effects</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-use-without-activerecord">Use Alternate ORMs</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-build-an-adapter">Build an Adapter</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-code-many-to-many-associations">Many-to-Many Relationships</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-code-polymorphic-associations">Polymorphic Relationships</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-add-defaults">Add Default Behavior</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-conditionally-render-fields">Conditionally Render Fields</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-customize-error-responses">Customize Error Responses</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-write-specs">Write Specs</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-return-statistics">Statistics</a>
              </li>
            
              <li>
                <a href="http://localhost:4000/how-to-autodocument">Autodocument with Swagger</a>
              </li>
            
          </ul>
        </li>
        <li>
          <a class="nav-link" href="mailto:richmolj@gmail.com">Contact</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li>
          <a href="https://github.com/jsonapi-suite/jsonapi_suite" class="button">Fork on Github</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

        <div id="docs">
  <div id="guide">
    <h1 class="logo">
      <a href="index.html">JSONAPI Suite</a>
    </h1>
    <ul class="menu nav">
      
        <li>
          <a href="#resources">Resources</a>
        </li>
      
        <li>
          <a href="#serializers">Serializers</a>
        </li>
      
        <li>
          <a href="#sideloading">Sideloading</a>
        </li>
      
        <li>
          <a href="#sideposting">Sideposting</a>
        </li>
      
    </ul>
  </div>

  <div id="api-docs">
    <div id="methods">
      
        <div class="method" id="resources">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>Resources</h3>
              <p>
  <a href="https://jsonapi-suite.github.io/jsonapi_compliable/JsonapiCompliable/Resource.html">Resources</a> are where you define how to query and persist a given <code class="highlighter-rouge">Model</code>.
  We'll wire-up the JSONAPI contract for you, so you can customize hooks rather
  than spend your time parsing query parameters.
</p>

<p>
To the right, you'll see potential overrides of default behavior. Our defaults are based on <code class="highlighter-rouge">ActiveRecord</code>
  and Rails conventions - so customizations like this are often not required.
</p>

<p>
  If you find yourself writing the same customizations over and over again, DRY them up by writing an
  <a href="https://jsonapi-suite.github.io/jsonapi_compliable/JsonapiCompliable/Adapters/Abstract.html">Adapter</a>.
</p>

<p>
  See also:
  <ul>
    <li>
      <a href="http://localhost:4000/how-to-use-without-activerecord">How to use alternate ORMs</a>
    </li>
    <li>
      <a href="http://localhost:4000/how-to-build-an-adapter">How to build an Adapter</a>
    </li>
    <li>
      <a href="http://localhost:4000/how-to-add-defaults">How to add default behavior</a>
    </li>
    <li>
      <a href="http://localhost:4000/how-to-add-defaults">How to cause side-effects</a>
    </li>
  </ul>
</p>

            </div>
            <div class="method-example">
              <pre>
                <code class="ruby">
class PostResource &lt; ApplicationResource
  # Use default logic (specified in adapter)
  # when no block passed
  allow_filter :active

  allow_filter :title_prefix do |scope, value|
    # Example:
    # scope.where(["title LIKE ?", "#{value}%"])
  end

  sort do |scope, att, dir|
    # Example:
    # scope.order(att =&gt; dir)
  end

  paginate do |scope, current_page, per_page|
    # Example:
    # scope.per(per_page).page(current_page)
  end

  # Example: let's say we're hitting an HTTP
  # service instead of ActiveRecord. Maybe our
  # scope is a big hash we build up, and now
  # we need to use a client to take that hash and
  # execute the HTTP request.
  def resolve(scope)
    MyHTTPClient.request(scope)
  end
end

                </code>
              </pre>
            </div>
          </div>
        </div>
      
        <div class="method" id="serializers">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>Serializers</h3>
              <p>
  <strong>Serializers</strong> define the structure of the response.
</p>

<p>
  We use <a href="http://jsonapi-rb.org">jsonapi-rb</a> for serialization. If you're familiar
  with <a href="https://github.com/rails-api/active_model_serializers">active_model_serializers</a>,
  the interface will seem very familiar. In fact, jsonapi-rb was created by one of the owners of that
  project.
</p>

<p>
  See also:
  <ul>
    <li>
      <a href="http://localhost:4000/how-to-conditionally-render-fields">How to Conditionally Render Fields</a>
    </li>
  </ul>
</p>

            </div>
            <div class="method-example">
              <pre>
                <code class="ruby">
class PostSerializer &lt; ApplicationSerializer
  type 'foos'

  attribute :title

  attribute :description do
    @object.active? ? 'Active Post' : 'Inactive Post'
  end

  extra_attribute :net_worth do
    @object.assets.sum(&amp;:value)
  end

  has_many :comments do
    data do
      @object.published_comments
    end

    link :related do
      @url_helpers.comments_url(filter: { post_id: @object.id })
    end
  end

  meta do
    { featured: true }
  end
end

                </code>
              </pre>
            </div>
          </div>
        </div>
      
        <div class="method" id="sideloading">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>Sideloading</h3>
              <p>
  You're probably already familiar with the concept of "sideloading", documented in
  the
  <a target="_blank" href="http://jsonapi.org/format/#fetching-includes">
    "Inclusion of Related Resources"
  </a>
  section of the JSONPI spec.
</p>

<p>
  If using an
  <a target="_blank" href="https://jsonapi-suite.github.io/jsonapi_compliable/JsonapiCompliable/Adapters/Abstract.html">
    Adapter
  </a>, such as the default
  <code class="highlighter-rouge">ActiveRecord</code> adapter,
  you can do this with simple
  <code class="highlighter-rouge">has_many</code>-style macros.
</p>

<p>
  If not using an adapter, or to implement a one-off customization,
  you can drop down to the lower-level
  <code class="highlighter-rouge">allow_sideload</code> DSL. Adapter
  macros are simply wrapping this DSL.
</p>

<p>
  <code class="highlighter-rouge">allow_sideload</code> specifies two simple
  configuration options:
  <ul>
    <li>
      <strong>scope</strong>: specifies how to build a scope that satisifes the
      association.
    </li>
    <li>
      <strong>assign</strong>: specifies how to associate the resulting records with
      their parent association.
    </li>
  </ul>

  <p>
    You can see the default
    <code class="highlighter-rouge">ActiveRecord</code> implementation on the right.
  </p>
</p>

<p>
  See also:

  <ul>
    <li>
      <a href="http://localhost:4000/how-to-use-without-activerecord">Use Alternate ORMs</a>
    </li>
    <li>
      <a href="http://localhost:4000/how-to-build-an-adapter">Build an Adapter</a>
    </li>
  </ul>
</p>

            </div>
            <div class="method-example">
              <pre>
                <code class="ruby">
# Adapter example
has_many :comments,
  foreign_key: :post_id,
  resource: CommentResource,
  scope: -&gt; { Comment.all } # base scope, like you'd see in a controller



# Lower-level customization example
allow_sideload :blog, resource: BlogResource do
  # Return a scope so further query parameters can be applied
  # and the Resource logic can be re-used
  data do |posts|
    Blog.where(id: posts.map(&amp;:blog_id))
  end

  assign do |posts, blogs|
    posts.each do |p|
      p.blog = blogs.find { |b| b.id == p.blog_id }
    end
  end
end

                </code>
              </pre>
            </div>
          </div>
        </div>
      
        <div class="method" id="sideposting">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>Sideposting</h3>
              <p>
  We want to be able to *write* a nested relationship graph.
  You can do this by mirroring the same
  <a href="http://jsonapi.org/format/#fetching-includes">sideloading payload</a>
  you see in read requests. To the right, you'll see we're updating a
  <code class="highlighter-rouge">Post</code>, changing the name of its associated
  <code class="highlighter-rouge">Blog</code>, creating two
  <code class="highlighter-rouge">Tag</code>s, deleting one
  <code class="highlighter-rouge">Comment</code>, and disassociating (<code class="highlighter-rouge">null</code> foreign key) a different
  <code class="highlighter-rouge">Comment</code>, all in a single request.
</p>

<p>
  When we send RESTful resources to the server, we typically send a corresponding HTTP verb.
  That's the
  <code class="highlighter-rouge">method</code> section of the payload.
  <code class="highlighter-rouge">method</code> can be either
  <code class="highlighter-rouge">create</code>,
  <code class="highlighter-rouge">update</code>,
  <code class="highlighter-rouge">destroy</code>, or
  <code class="highlighter-rouge">disassociate</code>.
</p>

<p>
  When creating, there is no
  <code class="highlighter-rouge">id</code> to pass. Instead, pass
  <code class="highlighter-rouge">temp-id</code>, a random uuid used to
  link the relevant sections of the payload, and which tells clients how to associate
  their in-memory objects with the
  <code class="highlighter-rouge">id</code>s returned from the server. Clients like
  <a target="_blank" href="https://github.com/jsonapi-suite/jsorm">JSORM</a> will take care of this for you automatically.
</p>

<p>
  When we actually perform these operations, everything will run within a transaction. The
  transaction will be rolled back if an error is raised or the
  <code class="highlighter-rouge">Model</code>s, do not pass validation.
</p>

<p>
  See also:

  <ul>
    <li>
      <a href="http://localhost:4000/tutorial#association-writes">Tutorial: Association Writes</a>
    </li>
  </ul>
</p>

            </div>
            <div class="method-example">
              <pre>
                <code class="ruby">
{
  data: {
    type: 'posts',
    id: 123,
    attributes: { title: 'Updated!' },
    relationships: {
      blog: {
        data: { type: 'blogs', id: 123, method: 'update' }
      },
      tags: {
        data: [{ type: 'tags', temp-id: 's0m3uu1d', method: 'create' }]
      },
      comments: {
        data: [
          { type: 'comments', id: 123, method: 'destroy' }
          { type: 'comments', id: 456, method: 'disassociate' }
        ]
      }
    }
  },
  included: [
    { type: 'tags', temp-id: 's0m3uu1d', attributes: { name: 'Important' } },
    { type: 'blogs', id: 123, attributes: { name: 'Updated!' } }
  ]
}

                </code>
              </pre>
            </div>
          </div>
        </div>
      
    </div>
  </div>
</div>

<script type="text/javascript">
  $(function () {
    window.addEventListener('scroll', function(e) {
      if (window.scrollY > 70) {
        $('#guide').css("margin-top", 0);
      } else {
        $('#guide').css("margin-top", 70+-1*window.scrollY);
      }
    });
  });
</script>

<script type="text/javascript">
  $(function () {
    hljs.configure({
      tabReplace: '  ',
      classPrefix: ''
    });

    $('.language-ruby code').addClass('ruby');
    $('.language-javascript code').addClass('javascript');

    hljs.initHighlightingOnLoad();
  });
</script>


      </div>
    </main>
    <div class="main-footer main-footer--dark">
  <div class="container">
    <div class="row">
      <div class="col-sm-3 menu">
        <h3>Overview</h3>
        <ul>
          <li>
            <a href="http://localhost:4000/quickstart">Quickstart</a>
          </li>
          <li>
            <a href="http://localhost:4000/tutorial">Tutorial</a>
          </li>
          <li>
            <a href="http://localhost:4000/concepts">Concepts</a>
          </li>
        </ul>
      </div>
      <div class="col-sm-3 menu">
        <h3>How-Tos</h3>
        <ul>
          
            <li>
              <a href="http://localhost:4000//how-to-scope-to-current-user">Scope to Current User</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-cause-side-effects">Cause Side-Effects</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-use-without-activerecord">Use Alternate ORMs</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-build-an-adapter">Build an Adapter</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-code-many-to-many-associations">Many-to-Many Relationships</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-code-polymorphic-associations">Polymorphic Relationships</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-add-defaults">Add Default Behavior</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-conditionally-render-fields">Conditionally Render Fields</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-customize-error-responses">Customize Error Responses</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-write-specs">Write Specs</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-return-statistics">Statistics</a>
            </li>
          
            <li>
              <a href="http://localhost:4000//how-to-autodocument">Autodocument with Swagger</a>
            </li>
          
        </ul>
      </div>
      <div class="col-sm-3 menu">
        <h3>Resources</h3>
        <ul>
          <li>
            <a target="_blank" href="https://jsonapi-suite.github.io/jsonapi_compliable">YARD Documentation</a>
          </li>
          <li>
            <a target="_blank" href="https://jsonapi-suite.slack.com/">Slack Chat</a>
          </li>
          <li>
            <a href="mailto:richmolj@gmail.com">Contact us</a>
          </li>
        </ul>
      </div>
      <div class="col-sm-3 menu">
        <h3>Related</h3>
        <ul>
          <li>
            <a target="_blank" href="http://jsonapi.org">JSONAPI Spec</a>
          </li>
          <li>
            <a target="_blank" href="http://jsonapi-rb.org">jsonapi-rb</a>
          </li>
          <li>
            <a target="_blank" href="https://glimmerjs.com">Glimmer</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

  </body>
</html>
