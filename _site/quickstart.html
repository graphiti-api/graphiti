<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>JSONAPI Suite</title>
  <meta name="description" content="Collection of Ruby libraries for powering JSONAPI-compliant APIs.">

  <link rel="stylesheet" href="/jsonapi_suite/assets/main.css?ref=wh4t3v45">
  <link rel="alternate" type="application/rss+xml" title="JSONAPI Suite" href="/jsonapi_suite/feed.xml">

  <!-- javascript -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  
</head>


  <body>
    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <header class="navbar navbar-inverse normal" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/jsonapi_suite/" class="navbar-brand">JSONAPI Suite</a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a class="nav-link" href="/jsonapi_suite/quickstart">Quickstart</a>
        </li>
        <li>
          <a class="nav-link" href="/jsonapi_suite/tutorial">Tutorial</a>
        </li>
        <li>
          <a class="nav-link" href="/jsonapi_suite/concepts">Concepts</a>
        </li>
        <li>
          <a class="nav-link" href="/jsonapi_suite/ruby">Docs</a>
        </li>
        <li>
          <a class="nav-link" href="/jsonapi_suite/js/home">Javascript Client</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li>
          <a href="https://github.com/jsonapi-suite/jsonapi_suite" class="button">Fork on Github</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

        <div class="container">
          <h1 id="quickstart">Quickstart</h1>

<h5 id="zero-to-api-in-5-minutes">Zero to API in 5 minutes</h5>

<p>This quickstart will use Rails with ActiveRecord. Head to the guides
section for usage with alternate ORMs or avoiding Rails
completely.</p>

<p>If the below seems too “magical”, don’t worry - we’re just applying some
sensible defaults to get started quickly.</p>

<h1 id="installation"><a href="#installation">Installation</a></h1>

<p>Let’s start with a classic Rails blog. We’ll use a <a href="http://guides.rubyonrails.org/rails_application_templates.html">template</a> to handle some of the boilerplate. Just run this command and accept all the defaults for now:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>rails new blog --api -m https://raw.githubusercontent.com/jsonapi-suite/rails_template/master/all.rb</code></pre></figure>

<p>Feel free to run <code class="highlighter-rouge">git diff</code> if you’re interested in the
particulars; this is mostly just installing gems and including modules.</p>

<blockquote>
  <p>Note: if a network issue prevents you from pointing to this URL
directly, you can download the file and and run this command as <code class="highlighter-rouge">-m
/path/to/all.rb</code></p>
</blockquote>

<h1 id="defining-a-resource"><a href="#defining-a-resource">Defining a Resource</a></h1>

<p>A <code class="highlighter-rouge">Resource</code> defines how to query and persist your <code class="highlighter-rouge">Model</code>. In other
words: a <code class="highlighter-rouge">Model</code> is to the database as <code class="highlighter-rouge">Resource</code> is to the API. So
first, let’s define our model:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bundle <span class="nb">exec </span>rails generate model Post title:string active:boolean
<span class="gp">$ </span>bundle <span class="nb">exec </span>rake db:migrate</code></pre></figure>

<p>Now we can use the built-in generator to define our <code class="highlighter-rouge">Resource</code>,
controller, and specs:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bundle <span class="nb">exec </span>rails g jsonapi:resource Post title:string active:boolean</code></pre></figure>

<p>You’ll see a number of files created. If you open each one, you’ll see
comments explaining what’s going on. Head over to the
<a href="tutorial">tutorial</a> for a more in-depth understanding. For now, let’s
focus on two key concepts you’ll see over and over again: inputs (via
<a href="https://jsonapi-suite.github.io/strong_resources/">strong_resources</a>),
and outputs (via <a href="http://jsonapi-rb.org">jsonapi-rb</a>).</p>

<p>Our <strong>API Inputs</strong> are defined in
<code class="highlighter-rouge">config/initializers/strong_resources.rb</code>. You can think of these as
<a href="http://api.rubyonrails.org/v5.0/classes/ActionController/StrongParameters.html">strong parameter</a> templates.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/strong_resources.rb</span>
<span class="n">strong_resource</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">attribute</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="n">attribute</span> <span class="ss">:active</span><span class="p">,</span> <span class="ss">:boolean</span>
<span class="k">end</span></code></pre></figure>

<p>Our <strong>API Outputs</strong> are defined in
<code class="highlighter-rouge">app/serializers/serializable_post.rb</code>. The DSL is very similar to
<a href="https://github.com/rails-api/active_model_serializers">active_model_serializers</a> and full documentation can be found at <a href="http://jsonapi-rb.org">jsonapi-rb.org</a>:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/serializers/serializable_post.rb</span>
<span class="k">class</span> <span class="nc">SerializablePost</span> <span class="o">&lt;</span> <span class="no">JSONAPI</span><span class="o">::</span><span class="no">Serializable</span><span class="o">::</span><span class="no">Resource</span>
  <span class="n">type</span> <span class="ss">:posts</span>

  <span class="n">attribute</span> <span class="ss">:title</span>
  <span class="n">attribute</span> <span class="ss">:active</span>
<span class="k">end</span></code></pre></figure>

<p>Now run your app!:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bundle <span class="nb">exec </span>rails s</code></pre></figure>

<p>Verify <code class="highlighter-rouge">http://localhost:3000/api/v1/posts</code> renders JSON correctly.
Now we just need data.</p>

<h1 id="seeding-data"><a href="#seeding-data">Seeding Data</a></h1>

<p>We can seed data in two ways: the usual <code class="highlighter-rouge">db/seeds.rb</code>, or using an HTTP
client. Using the client helps get your feet wet with client-side
development, or you can avoid the detour and plow right ahead.</p>

<h3 id="seeding-with-ruby"><a href="#seeding-with-ruby">Seeding With Ruby</a></h3>

<p>Edit <code class="highlighter-rouge">db/seeds.rb</code> to create a few <code class="highlighter-rouge">Post</code>s:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Post</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">title: </span><span class="s1">'My title!'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">true</span><span class="p">)</span>
<span class="no">Post</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">title: </span><span class="s1">'Another title!'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">false</span><span class="p">)</span>
<span class="no">Post</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">title: </span><span class="s1">'OMG! A title!'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">true</span><span class="p">)</span></code></pre></figure>

<p>And run the script:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bundle <span class="nb">exec </span>rake db:seed</code></pre></figure>

<h3 id="seeding-with-js-client"><a href="#seeding-with-node">Seeding With JS Client</a></h3>

<p>There are a variety of <a href="http://jsonapi.org/implementations/#client-libraries">JSONAPI Clients</a>
out there. We’ll be using <a href="https://jsonapi-suite.github.io/jsorm">JSORM</a>
which is built to work with Suite-specific functionality like nested
payloads. It can be used from the browser, but for now we’ll call
it using a simple Node script.</p>

<p>Create the project:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>mkdir node-seed <span class="o">&amp;&amp;</span> <span class="nb">cd </span>node-seed <span class="o">&amp;&amp;</span> touch index.js <span class="o">&amp;&amp;</span> npm init</code></pre></figure>

<p>Accept the default for all prompts. Now add the <code class="highlighter-rouge">JSORM</code> dependency, as
well as a polyfill for <code class="highlighter-rouge">fetch</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>npm install --save jsorm isomorphic-fetch</code></pre></figure>

<p>Add this seed code to <code class="highlighter-rouge">index.js</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">require</span><span class="p">(</span><span class="s2">"isomorphic-fetch"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">jsorm</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"jsorm/dist/jsorm"</span><span class="p">);</span>

<span class="c1">// setup code</span>

<span class="kd">var</span> <span class="nx">ApplicationRecord</span> <span class="o">=</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">JSORMBase</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">static</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">baseUrl</span><span class="p">:</span> <span class="s2">"http://localhost:3000"</span><span class="p">,</span>
    <span class="na">apiNamespace</span><span class="p">:</span> <span class="s2">"/api/v1"</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">Post</span> <span class="o">=</span> <span class="nx">ApplicationRecord</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">static</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">jsonapiType</span><span class="p">:</span> <span class="s2">"posts"</span>
  <span class="p">},</span>

  <span class="na">attrs</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
    <span class="na">active</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">attr</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// seed code</span>

<span class="kd">var</span> <span class="nx">post1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s2">"My title!"</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">post2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s2">"Another title!"</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">post3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s2">"OMG! A title!"</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="c1">// Save sequentially only due to local development env</span>
<span class="nx">post1</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">post2</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">post3</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>This should be pretty straightforward if you’re familiar with
<code class="highlighter-rouge">ActiveRecord</code>. We define <code class="highlighter-rouge">Model</code> objects, putting configuration on
class attributes. We instatiating instances of those Models, and call
<code class="highlighter-rouge">save()</code> to persist. For more information, see the <a href="https://jsonapi-suite.github.io/jsorm/">JSORM Documentation</a>.</p>

<p>Run the script:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>node index.js</code></pre></figure>

<p>Now load <code class="highlighter-rouge">http://localhost:3000/api/v1/posts</code>. You should have 3 <code class="highlighter-rouge">Post</code>s in
your database!</p>

<p><img src="assets/img/3_posts_json.png" alt="3_posts" /></p>

<h1 id="querying"><a href="#querying">Querying</a></h1>

<p>Now that we’ve defined our <code class="highlighter-rouge">Resource</code> and seeded some data, let’s see
what query functionality we have. We’ve listed all <code class="highlighter-rouge">Post</code>s at
<code class="highlighter-rouge">http://localhost:3000/api/v1/posts</code>. Let’s see what we can do:</p>

<ul>
  <li><strong>Sort</strong>
    <ul>
      <li>By title, ascending:
        <ul>
          <li>URL: <code class="highlighter-rouge">/api/v1/posts?sort=title</code></li>
          <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts ORDER BY title ASC</code></li>
        </ul>
      </li>
      <li>By title, descending:
        <ul>
          <li>URL: <code class="highlighter-rouge">/api/v1/posts?sort=-title</code></li>
          <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts ORDER BY title DESC</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Paginate</strong>:
    <ul>
      <li>2 Per page:
        <ul>
          <li>URL: <code class="highlighter-rouge">/api/v1/posts?page[size]=2</code></li>
          <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts LIMIT 2</code></li>
        </ul>
      </li>
      <li>2 Per page, second page:
        <ul>
          <li>URL: <code class="highlighter-rouge">/api/v1/posts?page[size]=2&amp;page[number]=2</code></li>
          <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts LIMIT 2 OFFSET 2</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Sparse Fieldsets</strong>:
    <ul>
      <li>Only render <code class="highlighter-rouge">title</code>, not <code class="highlighter-rouge">active</code>:
        <ul>
          <li>URL: <code class="highlighter-rouge">/api/v1/posts?fields[posts]=title</code></li>
          <li>SQL: <code class="highlighter-rouge">SELECT * from posts</code> (<em>optimizing this query is on the roadmap</em>)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Filter</strong>:
    <ul>
      <li>Add one line of code:</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/resources/post_resource.rb</span>
<span class="n">allow_filter</span> <span class="ss">:title</span></code></pre></figure>

<ul>
  <li>URL: <code class="highlighter-rouge">/api/v1/posts?filter[title]=My title!</code></li>
  <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts WHERE title = "My title!"</code></li>
  <li>Any filter not whitelisted will raise <code class="highlighter-rouge">JsonapiCompliable::BadFilter</code>
  error.</li>
  <li>All filter logic can be customized:</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># SELECT * from posts WHERE title LIKE 'My%'</span>
<span class="n">allow_filter</span> <span class="ss">:title_prefix</span> <span class="k">do</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
  <span class="n">scope</span><span class="p">.</span><span class="nf">where</span><span class="p">([</span><span class="s2">"title LIKE ?"</span><span class="p">,</span> <span class="s2">"</span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">%"</span><span class="p">])</span>
<span class="k">end</span></code></pre></figure>

<ul>
  <li>
    <p>Customizations can be DRYed up and packaged into <code class="highlighter-rouge">Adapter</code>s.</p>
  </li>
  <li>
    <p><strong>Extra Fields</strong>:</p>
    <ul>
      <li>Sometimes you want to request additional fields not part of a normal
response (perhaps they are computationally expensive).</li>
      <li>This can be done like so:</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/serializers/serializable_post.rb</span>
<span class="n">extra_attribute</span> <span class="ss">:description</span> <span class="k">do</span>
  <span class="vi">@object</span><span class="p">.</span><span class="nf">active?</span> <span class="p">?</span> <span class="s1">'Active Post'</span> <span class="p">:</span> <span class="s1">'Inactive Post'</span>
<span class="k">end</span></code></pre></figure>

<ul>
  <li>URL: <code class="highlighter-rouge">/api/v1/posts?extra_fields[posts]=description</code></li>
  <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts</code></li>
  <li>
    <p>You can conditionally eager load data or further customize this
  logic. See the tutorial for more.</p>
  </li>
  <li><strong>Statistics</strong>:
    <ul>
      <li>Useful for search grids - “Find me the first 10 active posts, and
the total count of all posts”.</li>
      <li>One line of code to whitelist the stat:</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/resources/post_resource.rb</span>
<span class="n">allow_stat</span> <span class="ss">total: </span><span class="p">[</span><span class="ss">:count</span><span class="p">]</span></code></pre></figure>

<ul>
  <li>URL: <code class="highlighter-rouge">/api/v1/posts?stats[total]=count</code></li>
  <li>SQL: <code class="highlighter-rouge">SELECT count(*) from posts</code></li>
  <li>Combine with filters and the count will adjust accordingly.</li>
  <li>There are a number of built-in stats, you can also add your own.</li>
  <li>
    <p>This is rendered in the <code class="highlighter-rouge">meta</code> section of the response:</p>

    <p><img src="assets/img/meta_total_count.png" alt="meta_total_count" /></p>
  </li>
  <li><strong>Error Handling</strong>:
    <ul>
      <li>Your app will always render a JSONAPI-compliable error response.</li>
      <li>Cause an error:</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/posts_controller.rb</span>
<span class="k">def</span> <span class="nf">index</span>
  <span class="k">raise</span> <span class="s1">'foo'</span>
<span class="k">end</span></code></pre></figure>

<ul>
  <li>
    <p>View the default payload:</p>

    <p><img src="assets/img/error_payload.png" alt="error_payload" /></p>
  </li>
  <li>
    <p>Different errors can be customized with different response codes,
  JSON, and side-effects. View <a href="https://jsonapi-suite.github.io/jsonapi_errorable/">jsonapi_errorable</a> for more.</p>
  </li>
</ul>

<h1 id="adding-relationships"><a href="#adding-relationships">Adding Relationships</a></h1>

<p>JSONAPI Suite supports full querying of relationships (“fetch me this
<code class="highlighter-rouge">Post</code> and 3 active <code class="highlighter-rouge">Comment</code>s sorted by creation date”), as well as
persistence (“save this <code class="highlighter-rouge">Post</code> and 3 <code class="highlighter-rouge">Comment</code>s in a single request”).</p>

<h3 id="adding-relationships-1"><a href="#relationship-setup">Adding Relationships</a></h3>

<p>Let’s start by defining our model:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bundle <span class="nb">exec </span>rails g model Comment post_id:integer body:text active:boolean
<span class="gp">$ </span>bundle <span class="nb">exec </span>rake db:migrate</code></pre></figure>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/post.rb</span>
<span class="n">has_many</span> <span class="ss">:comments</span>

<span class="c1"># app/models/comment.rb</span>
<span class="n">belongs_to</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">optional: </span><span class="kp">true</span></code></pre></figure>

<p>…and corresponding <code class="highlighter-rouge">Resource</code> object:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bundle <span class="nb">exec </span>rails g jsonapi:resource Comment body:text active:boolean</code></pre></figure>

<p>Configure the relationship in <code class="highlighter-rouge">PostResource</code>:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">has_many</span> <span class="ss">:comments</span><span class="p">,</span>
  <span class="ss">foreign_key: :post_id</span><span class="p">,</span>
  <span class="ss">resource: </span><span class="no">CommentResource</span><span class="p">,</span>
  <span class="ss">scope: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">all</span> <span class="p">}</span></code></pre></figure>

<p>This code:</p>

<ul>
  <li>Whitelists the relationship.</li>
  <li>Knows to link the objects via <code class="highlighter-rouge">post_id</code>.</li>
  <li>Will use <code class="highlighter-rouge">CommentResource</code> for querying logic (so we can say things
like “only return the latest 3 active comments”)</li>
  <li>Uses an unfiltered base scope (<code class="highlighter-rouge">Comment.all</code>). If we wanted, we could
do things like <code class="highlighter-rouge">Comment.active</code> here to ensure only active comments are
ever returned.</li>
</ul>

<p>You should now be able to hit <code class="highlighter-rouge">/api/v1/comments</code> with all the same
functionality as before. We just need to seed data.</p>

<p>Start by clearing out your database:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bundle <span class="nb">exec </span>rake db:migrate:reset</code></pre></figure>

<p>Again, you can seed your data using a NodeJS client or the traditional
<code class="highlighter-rouge">db/seeds.rb</code>.</p>

<h4 id="seeding-with-nodejs"><a href="#relationship-seeding-node">Seeding with NodeJS</a></h4>

<p>Let’s edit our <code class="highlighter-rouge">node-seed/index.js</code>. First add a <code class="highlighter-rouge">Comment</code> model:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Comment</span> <span class="o">=</span> <span class="nx">ApplicationRecord</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">static</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">jsonapiType</span><span class="p">:</span> <span class="s1">'comments'</span>
  <span class="p">},</span>

  <span class="na">attrs</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">body</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
    <span class="na">active</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
    <span class="na">createdAt</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">attr</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>…and add the relationship to <code class="highlighter-rouge">Post</code>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// within attrs</span>
<span class="c1">// ... code ...</span>
<span class="nl">comments</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">hasMany</span><span class="p">()</span>
<span class="c1">// ... code...</span></code></pre></figure>

<p>Replace the existing <code class="highlighter-rouge">Post</code> instances with one <code class="highlighter-rouge">Post</code> and three
<code class="highlighter-rouge">Comment</code>s:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">comment1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comment</span><span class="p">({</span>
  <span class="na">body</span><span class="p">:</span> <span class="s2">"comment one"</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">comment2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comment</span><span class="p">({</span>
  <span class="na">body</span><span class="p">:</span> <span class="s2">"comment two"</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">comment3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comment</span><span class="p">({</span>
  <span class="na">body</span><span class="p">:</span> <span class="s2">"comment three"</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s2">"My title!"</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">comments</span><span class="p">:</span> <span class="p">[</span><span class="nx">comment1</span><span class="p">,</span> <span class="nx">comment2</span><span class="p">,</span> <span class="nx">comment3</span><span class="p">]</span>
<span class="p">});</span>

<span class="nx">post</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span> <span class="na">with</span><span class="p">:</span> <span class="p">[</span><span class="s2">"comments"</span><span class="p">]</span> <span class="p">});</span></code></pre></figure>

<p>Tell our controller it’s OK to sidepost comments:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/posts_controller.rb</span>
<span class="n">strong_resource</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>
<span class="k">end</span></code></pre></figure>

<p>And tell our serializer it’s OK to render comments:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/serializers/serializable_post.rb</span>
<span class="n">has_many</span> <span class="ss">:comments</span></code></pre></figure>

<p>Now run the script to persist the <code class="highlighter-rouge">Post</code> and its three <code class="highlighter-rouge">Comment</code>s in a
single request:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>node node-seed/index.js</code></pre></figure>

<h4 id="seeding-with-ruby-1"><a href="#relationship-seeding-ruby">Seeding With Ruby</a></h4>

<p>Replace your <code class="highlighter-rouge">db/seeds.rb</code> with this code to persist one <code class="highlighter-rouge">Post</code> and
three <code class="highlighter-rouge">Comment</code>s:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">comment1</span> <span class="o">=</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">body: </span><span class="s1">'comment one'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">true</span><span class="p">)</span>
<span class="n">comment2</span> <span class="o">=</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">body: </span><span class="s1">'comment two'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">false</span><span class="p">)</span>
<span class="n">comment3</span> <span class="o">=</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">body: </span><span class="s1">'comment three'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">true</span><span class="p">)</span>

<span class="no">Post</span><span class="p">.</span><span class="nf">create!</span> <span class="p">\</span>
  <span class="ss">title: </span><span class="s1">'My title!'</span><span class="p">,</span>
  <span class="ss">active: </span><span class="kp">true</span><span class="p">,</span>
  <span class="ss">comments: </span><span class="p">[</span><span class="n">comment1</span><span class="p">,</span> <span class="n">comment2</span><span class="p">,</span> <span class="n">comment3</span><span class="p">]</span></code></pre></figure>

<h2 id="usage"><a href="#relationship-usage">Usage</a></h2>

<p>Now let’s fetch a <code class="highlighter-rouge">Post</code> and filtered <code class="highlighter-rouge">Comment</code>s in a single request: <code class="highlighter-rouge">/api/v1/posts?include=comments</code>.</p>

<p>Any logic in <code class="highlighter-rouge">CommentResource</code> is available to us. Let’s sort the
comments by <code class="highlighter-rouge">created_at</code> descending: <code class="highlighter-rouge">/api/v1/posts?include=comments&amp;sort=-comments.created_at</code>. This should work out-of-the-box.</p>

<p>Now add a filter to <code class="highlighter-rouge">CommentResource</code>:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">allow_filter</span> <span class="ss">:active</span></code></pre></figure>

<p>That filter now works in two places:</p>

<ul>
  <li><code class="highlighter-rouge">/api/v1/comments?filter[active]=true</code></li>
  <li><code class="highlighter-rouge">/api/v1/posts?include=comments&amp;filter[comments][active]=true</code></li>
</ul>

<p>This is why <code class="highlighter-rouge">Resource</code> objects exist: they provide an interface to
functionality shared across many different endpoints, with no extra
code.</p>

<h1 id="whats-next"><a href="#whats-next">What’s Next</a></h1>

<p>We have a full CRUD API with robust querying functionality, and the
ability to combine relationships for both reads and writes. But what
happens when you need to customize the sorting logic? What about replacing
<code class="highlighter-rouge">ActiveRecord</code> with an alternate persistence layer, or avoiding Rails
altogether?</p>

<p>These are important topics that JSONAPI Suite was built to address. To
learn more about advanced usage and customization, we suggest following
the <a href="tutorial">tutorial</a>. There are also a number of how-tos on this
site, a good one to start with is <a href="how-to-use-without-activerecord">How to Use without ActiveRecord</a></p>

<p>For additional documentation, view the <a href="https://jsonapi-suite.github.io/jsonapi_compliable/">YARD Docs</a>.</p>

<p>For help with specific use cases, <a href="https://join.slack.com/t/jsonapi-suite/shared_invite/enQtMjkyMTA3MDgxNTQzLWVkMDM3NTlmNTIwODY2YWFkMGNiNzUzZGMzOTY3YmNmZjBhYzIyZWZlZTk4YmI1YTI0Y2M0OTZmZGYwN2QxZjg">join our Slack chat</a>!</p>

<h1 id="bonus-testing"><a href="#testing">Bonus: Testing</a></h1>

<h3 id="installation-1"><a href="#testing-install">Installation</a></h3>

<p>Our generator applied some sensible defaults:</p>

<ul>
  <li><a href="https://github.com/rspec/rspec-rails">Rspec</a> Test runner</li>
  <li><a href="https://jsonapi-suite.github.io/jsonapi_spec_helpers">jsonapi_spec_helpers</a> Helpers to parse and assert on JSONAPI payloads.</li>
  <li><a href="https://github.com/thoughtbot/factory_girl">factory_girl</a> for
  seeding our test database with fake data.</li>
  <li><a href="https://github.com/stympy/faker">faker</a> for generating fake values,
  such as e-mail addresses, names, avatar URLs, etc.</li>
  <li><a href="https://github.com/DatabaseCleaner/database_cleaner">database_cleaner</a>
  to ensure our fake data gets cleaned up between test runs.</li>
</ul>

<p>By default we rescue exceptions and return a valid <a href="http://jsonapi.org/format/#errors">error response</a>.
In tests, this can be confusing - we probably want to raise errors in
tests. So note our exception handling is disabled by default:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># spec/rails_helper.rb</span>
<span class="n">config</span><span class="p">.</span><span class="nf">before</span> <span class="ss">:each</span> <span class="k">do</span>
  <span class="no">JsonapiErrorable</span><span class="p">.</span><span class="nf">disable!</span>
<span class="k">end</span></code></pre></figure>

<p>But you can enable it on a per-test basis:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">it</span> <span class="s2">"renders validation errors"</span> <span class="k">do</span>
  <span class="no">JsonapiErrorable</span><span class="p">.</span><span class="nf">enable!</span>
  <span class="n">post</span> <span class="s2">"/api/v1/employees"</span><span class="p">,</span> <span class="n">payload</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">validation_errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">]).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"can't be blank"</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<p>In following this guide, we generated <code class="highlighter-rouge">Post</code> and
<code class="highlighter-rouge">Comment</code> resources. Let’s edit our <a href="https://github.com/thoughtbot/factory_bot">factories</a> to seed randomized data:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># spec/factories/post.rb</span>
<span class="no">FactoryGirl</span><span class="p">.</span><span class="nf">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
    <span class="n">title</span> <span class="p">{</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Lorem</span><span class="p">.</span><span class="nf">sentence</span> <span class="p">}</span>
    <span class="n">active</span> <span class="p">{</span> <span class="p">[</span><span class="kp">true</span><span class="p">,</span> <span class="kp">false</span><span class="p">].</span><span class="nf">sample</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># spec/factories/comment.rb</span>
<span class="no">FactoryGirl</span><span class="p">.</span><span class="nf">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:comment</span> <span class="k">do</span>
    <span class="n">body</span> <span class="p">{</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Lorem</span><span class="p">.</span><span class="nf">paragraph</span> <span class="p">}</span>
    <span class="n">active</span> <span class="p">{</span> <span class="p">[</span><span class="kp">true</span><span class="p">,</span> <span class="kp">false</span><span class="p">].</span><span class="nf">sample</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Finally, we need to define a <code class="highlighter-rouge">Payload</code>. <code class="highlighter-rouge">Payload</code>s use a
<code class="highlighter-rouge">factory_girl</code>-style DSL to define expected JSON. A <code class="highlighter-rouge">Payload</code> compares a
<code class="highlighter-rouge">Model</code> instance and JSON output, ensuring:</p>

<ul>
  <li>No unexpected keys</li>
  <li>No missing keys</li>
  <li>No unexpected value types</li>
  <li>No <code class="highlighter-rouge">null</code> values (this is overrideable)</li>
  <li>Model attribute matches JSON attribute</li>
  <li>This can all be customized. See <a href="https://github.com/jsonapi-suite/jsonapi_spec_helpers">jsonapi_spec_helpers</a> for more.</li>
</ul>

<p>Let’s define our payloads now:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># spec/payloads/post.rb</span>
<span class="no">JsonapiSpecHelpers</span><span class="o">::</span><span class="no">Payload</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">key</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span>
  <span class="n">key</span><span class="p">(</span><span class="ss">:active</span><span class="p">,</span> <span class="p">[</span><span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span><span class="p">])</span>
<span class="k">end</span>

<span class="c1"># spec/payloads/comment.rb</span>
<span class="no">JsonapiSpecHelpers</span><span class="o">::</span><span class="no">Payload</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="ss">:comment</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">key</span><span class="p">(</span><span class="ss">:body</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span>
  <span class="n">key</span><span class="p">(</span><span class="ss">:active</span><span class="p">,</span> <span class="p">[</span><span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span><span class="p">])</span>
  <span class="n">key</span><span class="p">(</span><span class="ss">:created_at</span><span class="p">,</span> <span class="no">Time</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<h3 id="run"><a href="#testing-rub">Run</a></h3>

<p>We can now run specs. Let’s start with the <code class="highlighter-rouge">Post</code> specs:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>bundle <span class="nb">exec </span>rspec spec/api/v1/posts</code></pre></figure>

<p>You should see five specs, with one failing (<code class="highlighter-rouge">spec/api/v1/posts/create_spec.rb</code>),
and one pending (<code class="highlighter-rouge">spec/api/v1/posts/update_spec.rb</code>).</p>

<p>The reason for the failure is simple: our payload defined in
<code class="highlighter-rouge">spec/payloads/post.rb</code> specifies that a <code class="highlighter-rouge">Post</code> JSON should include the
key <code class="highlighter-rouge">title</code>. However, that spec is currently creating a <code class="highlighter-rouge">Post</code> with no
attributes…which means in the response JSON, <code class="highlighter-rouge">title</code> is <code class="highlighter-rouge">null</code>. <code class="highlighter-rouge">null</code>
values will fail <code class="highlighter-rouge">assert_payload</code> unless elsewise configured.</p>

<p>So, let’s update our spec to POST attributes, not just an empty object:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">let</span><span class="p">(</span><span class="ss">:payload</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span>
    <span class="ss">data: </span><span class="p">{</span>
      <span class="ss">type: </span><span class="s1">'posts'</span><span class="p">,</span>
      <span class="ss">attributes: </span><span class="p">{</span>
        <span class="ss">title: </span><span class="s1">'My title!'</span><span class="p">,</span>
        <span class="ss">active: </span><span class="kp">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="k">end</span></code></pre></figure>

<p>Your specs should now pass. The only pending spec is due to a similar
issue - we need to specify attributes in <code class="highlighter-rouge">spec/api/v1/posts/update_spec.rb</code> as
well. Follow the comments in that file to apply a similar change.</p>

<p>You should now have 5 passing request specs! These specs spin up a fake
server, then execute full-stack requests that hit the database and
return JSON. You’re asserting that JSON matches predefined payloads,
without <code class="highlighter-rouge">null</code>s or unknown key/values.</p>

<p>Go ahead and make the same changes to <code class="highlighter-rouge">Comment</code> specs to get 10 passing
request specs.</p>

<p>It’s up to you how far you’d like to go with testing. Should you add a
new spec to <code class="highlighter-rouge">spec/api/v1/posts/index_spec.rb</code> every time you add a
filter with <code class="highlighter-rouge">allow_filter</code>? This boils down to personal preference and
tolerance of failures. Try adding a few specs following the generated
patterns to get a feel for what’s right for you.</p>

<h3 id="bonus-documentation"><a href="#documentation">Bonus: Documentation</a></h3>

<p>We can autodocument our code using <a href="https://swagger.io">swagger documentation</a>. Documenting an endpoint is one line of code:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">jsonapi_resource</span> <span class="s1">'/v1/employees'</span></code></pre></figure>

<p>Visit <code class="highlighter-rouge">http://localhost:3000/api/docs</code> to see the swagger documentation. Our custom UI will show all possible query parameters (including nested
relationships), as well as schemas for request/responses:</p>

<p><img style="width: 100%" src="https://user-images.githubusercontent.com/55264/28526490-af7ce5a8-7055-11e7-88bf-1ce5ead32dd7.png" /></p>

<p>Our generator set up some boilerplate to enable this functionality, you
can learn more at: <a href="how-to-autodocument">How to Autodocument with Swagger</a></p>

<p><br />
<br />
<br /></p>

        </div>
      </div>
    </main>
    <div class="main-footer main-footer--dark">
  <div class="container">
    <div class="row">
      <div class="col-sm-4 menu">
        <h3>Overview</h3>
        <ul>
          <li>
            <a href="/jsonapi_suite/quickstart">Quickstart</a>
          </li>
          <li>
            <a href="/jsonapi_suite/tutorial">Tutorial</a>
          </li>
          <li>
            <a href="/jsonapi_suite/concepts">Concepts</a>
          </li>
        </ul>
      </div>
      <div class="col-sm-4 menu">
        <h3>Resources</h3>
        <ul>
          <li>
            <a target="_blank" href="https://jsonapi-suite.github.io/jsonapi_compliable">YARD Documentation</a>
          </li>
          <li>
            <a target="_blank" href="https://join.slack.com/t/jsonapi-suite/shared_invite/enQtMjkyMTA3MDgxNTQzLWVkMDM3NTlmNTIwODY2YWFkMGNiNzUzZGMzOTY3YmNmZjBhYzIyZWZlZTk4YmI1YTI0Y2M0OTZmZGYwN2QxZjg">Slack Chat</a>
          </li>
          <li>
            <a href="mailto:richmolj@gmail.com">Contact us</a>
          </li>
        </ul>
      </div>
      <div class="col-sm-4 menu">
        <h3>Related</h3>
        <ul>
          <li>
            <a target="_blank" href="http://jsonapi.org">JSONAPI Spec</a>
          </li>
          <li>
            <a target="_blank" href="http://jsonapi-rb.org">jsonapi-rb</a>
          </li>
          <li>
            <a target="_blank" href="https://vuejs.org/">VueJS</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <script type="text/javascript">
$(function () {

  var flipTabs = function() {
    var isTS = true;
    if (localStorage.getItem('js-lang') === 'javascript') {
      isTS = false;
    }

    $('.code-tabs').each(function(index, el) {
      if (isTS) {
        console.log('hiding js');
        $($(el).children()[1]).hide();
        $($(el).children()[0]).show();
      } else {
        console.log('hiding ts');
        $($(el).children()[0]).hide();
        $($(el).children()[1]).show();
      }
    });

    if (isTS) {
      $('.tab.typescript').addClass('active');
      $('.tab.javascript').removeClass('active');
    } else {
      $('.tab.typescript').removeClass('active');
      $('.tab.javascript').addClass('active');
    }
  }

  $('.tab').click(function() {
    console.log('HEREERERE');
    if ($(this).hasClass('typescript')) {
      localStorage.setItem('js-lang', 'typescript');
    } else {
      localStorage.setItem('js-lang', 'javascript');
    }

    flipTabs();
  });

  flipTabs();
})
</script>

  </body>
</html>
